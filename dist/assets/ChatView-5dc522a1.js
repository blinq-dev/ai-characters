var Le=Object.defineProperty;var Ee=(a,i,e)=>i in a?Le(a,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[i]=e;var m=(a,i,e)=>(Ee(a,typeof i!="symbol"?i+"":i,e),e);import{g as Me,h as Te,e as u,i as Re,j as Ve,k as Ne,l as p,m as k,p as Oe,d as de,u as he,a as Z,o as L,c as M,q as H,b as n,s as D,f as pe,n as ge,v as _,x as E,F as J,y as Pe,z as j,A as De,B as oe,t as R,C as Ie,r as re,D as Ae,E as Be,G as We}from"./index-c9b7f27f.js";import{u as me,C as V}from"./chat-9d706244.js";function fe(a){return Me()?(Te(a),!0):!1}function K(a){return typeof a=="function"?a():u(a)}const ve=typeof window<"u",ee=()=>{},X=Ue();function Ue(){var a;return ve&&((a=window==null?void 0:window.navigator)==null?void 0:a.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent)}const ae={mounted:"mounted",updated:"updated",unmounted:"unmounted"};function $e(...a){if(a.length!==1)return Re(...a);const i=a[0];return typeof i=="function"?Ve(Ne(()=>({get:i,set:ee}))):p(i)}function B(a){var i;const e=K(a);return(i=e==null?void 0:e.$el)!=null?i:e}const be=ve?window:void 0;function q(...a){let i,e,s,t;if(typeof a[0]=="string"||Array.isArray(a[0])?([e,s,t]=a,i=be):[i,e,s,t]=a,!i)return ee;Array.isArray(e)||(e=[e]),Array.isArray(s)||(s=[s]);const r=[],h=()=>{r.forEach(b=>b()),r.length=0},c=(b,C,g,f)=>(b.addEventListener(C,g,f),()=>b.removeEventListener(C,g,f)),v=k(()=>[B(i),K(t)],([b,C])=>{h(),b&&r.push(...e.flatMap(g=>s.map(f=>c(b,g,f,C))))},{immediate:!0,flush:"post"}),S=()=>{v(),h()};return fe(S),S}let le=!1;function ue(a,i,e={}){const{window:s=be,ignore:t=[],capture:r=!0,detectIframe:h=!1}=e;if(!s)return;X&&!le&&(le=!0,Array.from(s.document.body.children).forEach(g=>g.addEventListener("click",ee)));let c=!0;const v=g=>t.some(f=>{if(typeof f=="string")return Array.from(s.document.querySelectorAll(f)).some(y=>y===g.target||g.composedPath().includes(y));{const y=B(f);return y&&(g.target===y||g.composedPath().includes(y))}}),b=[q(s,"click",g=>{const f=B(a);if(!(!f||f===g.target||g.composedPath().includes(f))){if(g.detail===0&&(c=!v(g)),!c){c=!0;return}i(g)}},{passive:!0,capture:r}),q(s,"pointerdown",g=>{const f=B(a);f&&(c=!g.composedPath().includes(f)&&!v(g))},{passive:!0}),h&&q(s,"blur",g=>{setTimeout(()=>{var f;const y=B(a);((f=s.document.activeElement)==null?void 0:f.tagName)==="IFRAME"&&!(y!=null&&y.contains(s.document.activeElement))&&i(g)},0)})].filter(Boolean);return()=>b.forEach(g=>g())}const Fe={[ae.mounted](a,i){const e=!i.modifiers.bubble;if(typeof i.value=="function")a.__onClickOutside_stop=ue(a,i.value,{capture:e});else{const[s,t]=i.value;a.__onClickOutside_stop=ue(a,s,Object.assign({capture:e},t))}},[ae.unmounted](a){a.__onClickOutside_stop()}};function we(a){const i=window.getComputedStyle(a);if(i.overflowX==="scroll"||i.overflowY==="scroll"||i.overflowX==="auto"&&a.clientWidth<a.scrollWidth||i.overflowY==="auto"&&a.clientHeight<a.scrollHeight)return!0;{const e=a.parentNode;return!e||e.tagName==="BODY"?!1:we(e)}}function ze(a){const i=a||window.event,e=i.target;return we(e)?!1:i.touches.length>1?!0:(i.preventDefault&&i.preventDefault(),!1)}function Ge(a,i=!1){const e=p(i);let s=null,t;k($e(a),c=>{if(c){const v=c;t=v.style.overflow,e.value&&(v.style.overflow="hidden")}},{immediate:!0});const r=()=>{const c=K(a);!c||e.value||(X&&(s=q(c,"touchmove",v=>{ze(v)},{passive:!1})),c.style.overflow="hidden",e.value=!0)},h=()=>{const c=K(a);!c||!e.value||(X&&(s==null||s()),c.style.overflow=t,e.value=!1)};return fe(h),Oe({get(){return e.value},set(c){c?r():h()}})}function je(){let a=!1;const i=p(!1);return(e,s)=>{if(i.value=s.value,a)return;a=!0;const t=Ge(e,s.value);k(i,r=>t.value=r)}}je();const He={class:"absolute w-full px-3 items-center -mt-10 uppercase left-0 text-white bold text-sm flex gap-3 opacity-0 hover:opacity-100 transition"},qe={key:0},Ke=["innerHTML"],Qe=["innerHTML"],Ye={key:1,class:"fixed flex flex-col z-50 top-0 bottom-24 left-0 right-0 backdrop-brightness-90 backdrop-blur-3xl rounded-2xl text-white/80 p-5 m-10"},Je={class:"overflow-scroll grow"},Xe=de({__name:"ChatBubble",props:{message:{},showUser:{type:Boolean}},setup(a){const i=a,e=me(),s=he(),t=Z(),r=p(!1);let h="";const c=()=>{r.value=!1,i.message.setContentWeirdBug(h)},v=()=>{r.value=!0,h=i.message.getContentWeirdBug()},S=()=>{e.saveMessages(s.selectedCharacter.botSlug),r.value=!1},b=()=>{e.deleteMessage(i.message),e.saveMessages(s.selectedCharacter.botSlug),r.value=!1};return(C,g)=>(L(),M(J,null,[u(i).message.role!="system"?(L(),M("div",{key:0,class:H(["flex flex-col w-10/12 md:w-3/4 lg:w-2/3 xl:w-5/12",{"self-end rounded-br-none":u(i).message.side=="right","self-start rounded-bl-none":u(i).message.side=="left"}])},[n("div",{class:H(["relative backdrop-blur-xl p-3 rounded-2xl text-white bg-[#434851]",{"mr-1 md:mr-8 ":u(i).message.side=="right","ml-1 md:ml-8  ":u(i).message.side=="left","rounded-br-none":u(i).showUser&&u(i).message.side=="right","rounded-bl-none":u(i).showUser&&u(i).message.side=="left"}]),style:{}},[n("div",He,[u(i).message.isCheckpoint()?(L(),M("span",qe,"Checkpoint")):D("",!0),n("button",{onClick:v,class:"uppercase opacity-20 hover:opacity-100"},"Edit"),n("button",{onClick:b,class:"uppercase opacity-20 hover:opacity-100"},"Delete")]),n("span",{class:"markdown",innerHTML:u(i).message.getHtmlContent()},null,8,Ke)],2),C.showUser?(L(),M("div",{key:0,class:H(["text-white mb-4",{"self-end":u(i).message.side=="right"}])},[n("div",{class:"w-16 h-16 mt-3 rounded-3xl flex items-center justify-center",style:ge({backgroundColor:u(i).message.side==="left"?"#a8d2fc":u(s).selectedCharacter.color})},[n("div",{class:"",innerHTML:u(pe)(u(i).message.side==="left"?u(t).avatar:u(s).selectedCharacter.avatar)},null,8,Qe)],4)],2)):D("",!0)],2)):D("",!0),r.value?_((L(),M("div",Ye,[n("div",Je,[_(n("textarea",{class:"w-full h-full bg-transparent","onUpdate:modelValue":g[0]||(g[0]=f=>u(i).message.content=f)},null,512),[[E,u(i).message.content]])]),n("div",{class:"flex gap-2 mt-4 shrink-0"},[n("button",{onClick:S,class:"backdrop-brightness-50 backdrop-blur-xl text-white rounded-lg p-2"},"Save"),n("button",{onClick:b,class:"backdrop-brightness-50 backdrop-blur-xl text-white rounded-lg p-2"},"Delete message"),n("button",{onClick:c,class:"backdrop-brightness-50 backdrop-blur-xl text-white rounded-lg p-2"},"Dismiss")])])),[[u(Fe),c]]):D("",!0)],64))}});class te{constructor(){m(this,"callbacks",[])}on(i,e){this.callbacks.push({callback:e,event:i})}off(i,e){this.callbacks=this.callbacks.filter(s=>s.event!==i||e&&s.callback!==e)}once(i,e){const s=t=>{e(t),this.off(i,s)};return this.on(i,s),s}trigger(i,e){this.callbacks.filter(s=>s.event===i).forEach(s=>s.callback(e))}}class Ze extends te{constructor(e="en-US"){super();m(this,"recognition");m(this,"status");m(this,"transcript");m(this,"interimTranscript");m(this,"isListening",p(!1));m(this,"startWord",p("start nu"));m(this,"stopWord",p("stop nu"));m(this,"autoRestart",p(!0));m(this,"isStopping",!1);m(this,"timeout",1e3);m(this,"debounced",null);try{this.recognition=new webkitSpeechRecognition}catch{this.recognition=new SpeechRecognition}this.recognition.lang=e,this.status=p("initializing"),this.transcript=p(""),this.interimTranscript=p(""),this.recognition.onstart=this.onStart.bind(this),this.recognition.onresult=this.onResult.bind(this),this.recognition.onerror=this.onError.bind(this),this.recognition.onend=this.onEnd.bind(this),this.recognition.continuous=!0,this.recognition.interimResults=!0,this.recognition.lang=e}setLanguage(e){this.recognition.lang=e}onStart(){this.status.value="started"}startListen(){if(this.isListening.value=!0,console.log("Status",this.status.value),this.status.value!=="started")try{this.start(),this.status.value="started"}catch{this.status.value="error"}}stopListen(){this.isListening.value=!1,this.isStopping=!0,this.stop(),this.interimTranscript.value=""}toggleListen(){this.isListen()?this.stopListen():this.startListen()}isListen(){return this.isListening.value}onResult(e){if(this.status.value="result",this.isStopping){this.transcriptDone();return}this.interimTranscript.value="";for(let s=e.resultIndex;s<e.results.length;++s){let t=e.results[s][0].transcript;t.toLowerCase().includes(this.startWord.value)&&this.startListen(),this.isListen()&&(t=t.replace(new RegExp(`.*${this.startWord.value}`,"gi"),""),t=t.replace(new RegExp(`${this.stopWord.value}.*`,"gi"),""),this.interimTranscript.value+=t)}if(this.isListen()){if(this.interimTranscript.value.toLowerCase().includes(this.stopWord.value)){this.transcriptDone(),this.stopListen();return}this.debounced!==null&&clearTimeout(this.debounced),this.debounced=setTimeout(()=>{this.isListen()&&this.transcriptDone()},this.timeout)}}transcriptDone(){var s;this.isStopping=!0,(s=this.recognition)==null||s.stop();let e=this.interimTranscript.value;e=e.replace(new RegExp(`.*${this.startWord.value}`,"gi"),""),e=e.replace(new RegExp(`${this.stopWord.value}.*`,"gi"),""),e&&this.trigger("transcript",e),this.interimTranscript.value=""}onError(e){this.status.value="error",console.log(e)}onEnd(){this.status.value="stopped",this.isStopping=!1,this.autoRestart&&setTimeout(()=>{this.start()},1),this.trigger("ended",null)}async start(){var e;if(this.status.value!=="started")try{(e=this.recognition)==null||e.start()}catch(s){console.error(s)}}stop(){var e;this.isStopping=!0,this.autoRestart=!1,this.once("ended",()=>{this.autoRestart=!0,this.isStopping=!1}),this.status.value==="started"&&((e=this.recognition)==null||e.stop())}}var Se={};(function(a){var i=function(e,s){if(!(this instanceof i))return new i(e,s);this.INITIALIZING=-1,this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,this.url=e,s=s||{},this.headers=s.headers||{},this.payload=s.payload!==void 0?s.payload:"",this.method=s.method||this.payload&&"POST"||"GET",this.withCredentials=!!s.withCredentials,this.FIELD_SEPARATOR=":",this.listeners={},this.xhr=null,this.readyState=this.INITIALIZING,this.progress=0,this.chunk="",this.addEventListener=function(t,r){this.listeners[t]===void 0&&(this.listeners[t]=[]),this.listeners[t].indexOf(r)===-1&&this.listeners[t].push(r)},this.removeEventListener=function(t,r){if(this.listeners[t]!==void 0){var h=[];this.listeners[t].forEach(function(c){c!==r&&h.push(c)}),h.length===0?delete this.listeners[t]:this.listeners[t]=h}},this.dispatchEvent=function(t){if(!t)return!0;t.source=this;var r="on"+t.type;return this.hasOwnProperty(r)&&(this[r].call(this,t),t.defaultPrevented)?!1:this.listeners[t.type]?this.listeners[t.type].every(function(h){return h(t),!t.defaultPrevented}):!0},this._setReadyState=function(t){var r=new CustomEvent("readystatechange");r.readyState=t,this.readyState=t,this.dispatchEvent(r)},this._onStreamFailure=function(t){var r=new CustomEvent("error");r.data=t.currentTarget.response,this.dispatchEvent(r),this.close()},this._onStreamAbort=function(t){this.dispatchEvent(new CustomEvent("abort")),this.close()},this._onStreamProgress=function(t){if(this.xhr){if(this.xhr.status!==200){this._onStreamFailure(t);return}this.readyState==this.CONNECTING&&(this.dispatchEvent(new CustomEvent("open")),this._setReadyState(this.OPEN));var r=this.xhr.responseText.substring(this.progress);this.progress+=r.length,r.split(/(\r\n|\r|\n){2}/g).forEach(function(h){h.trim().length===0?(this.dispatchEvent(this._parseEventChunk(this.chunk.trim())),this.chunk=""):this.chunk+=h}.bind(this))}},this._onStreamLoaded=function(t){this._onStreamProgress(t),this.dispatchEvent(this._parseEventChunk(this.chunk)),this.chunk=""},this._parseEventChunk=function(t){if(!t||t.length===0)return null;var r={id:null,retry:null,data:"",event:"message"};t.split(/\n|\r\n|\r/).forEach(function(c){c=c.trimRight();var v=c.indexOf(this.FIELD_SEPARATOR);if(!(v<=0)){var S=c.substring(0,v);if(S in r){var b=c.substring(v+1).trimLeft();S==="data"?r[S]+=b:r[S]=b}}}.bind(this));var h=new CustomEvent(r.event);return h.data=r.data,h.id=r.id,h},this._checkStreamClosed=function(){this.xhr&&this.xhr.readyState===XMLHttpRequest.DONE&&this._setReadyState(this.CLOSED)},this.stream=function(){this._setReadyState(this.CONNECTING),this.xhr=new XMLHttpRequest,this.xhr.addEventListener("progress",this._onStreamProgress.bind(this)),this.xhr.addEventListener("load",this._onStreamLoaded.bind(this)),this.xhr.addEventListener("readystatechange",this._checkStreamClosed.bind(this)),this.xhr.addEventListener("error",this._onStreamFailure.bind(this)),this.xhr.addEventListener("abort",this._onStreamAbort.bind(this)),this.xhr.open(this.method,this.url);for(var t in this.headers)this.xhr.setRequestHeader(t,this.headers[t]);this.xhr.withCredentials=this.withCredentials,this.xhr.send(this.payload)},this.close=function(){this.readyState!==this.CLOSED&&(this.xhr.abort(),this.xhr=null,this._setReadyState(this.CLOSED))}};a.SSE=i})(Se);class ce extends te{constructor(){super();m(this,"status");m(this,"result");m(this,"chatbot","");m(this,"model","gpt-3.5-turbo");m(this,"config",{model:"gpt-3.5-turbo",temperature:1,messages:[],stream:!0});this.status=p("initializing"),this.result=p("")}async complete(e){let s=Z();if(!s.apiKey&&(s.apiKey=prompt("Please enter your OpenAI API key",s.apiKey??""),s.saveSettings(),!s.apiKey))return;let t=new Se.SSE("https://api.openai.com/v1/chat/completions",{headers:{"Content-Type":"application/json",Authorization:"Bearer "+s.apiKey},method:"POST",payload:JSON.stringify({...this.config,...e??{},stream:!0})});t.addEventListener("message",async r=>{if(r.data==="[DONE]"){t.close(),this.trigger("done",this.result.value),this.result.value="";return}var h=JSON.parse(r.data);let c=h.choices[0].delta.content??"";this.result.value+=c,this.trigger("progress",{result:this.result.value,partial:c})}),t.stream(),t.onerror=r=>{let h=JSON.parse(r.data);h.error.code=="invalid_api_key"&&(s.apiKey=prompt("Please enter your OpenAI API key",s.apiKey??""),s.saveSettings()),h.error.code=="context_length_exceeded"&&s.model!=s.largeModel?(s.model=s.largeModel,console.log("Switching to large model"),this.complete({...e,model:s.largeModel})):alert("Error: "+r.data)}}}class et extends te{constructor(e="en-US"){super();m(this,"provider");m(this,"status");m(this,"voiceList",p([]));m(this,"selectedVoice",p(""));m(this,"language","en-US");m(this,"pitch",1);m(this,"rate",1);m(this,"queue",[]);m(this,"isSpeakingQueue",p(!1));m(this,"partialBuffer","");m(this,"partialTimeout",null);this.provider=window.speechSynthesis,this.status=p("started"),this.language=e,this.populateVoiceList(),this.provider.onvoiceschanged=this.populateVoiceList.bind(this),k(this.selectedVoice,()=>{console.log("Selected voice changed",this.selectedVoice.value),window.localStorage.setItem("selectedVoice",this.selectedVoice.value)})}setLanguage(e){this.language=e,this.populateVoiceList()}populateVoiceList(){if(this.provider!==null&&(this.voiceList.value=this.provider.getVoices(),this.voiceList.value.unshift({default:!1,lang:"",localService:!1,name:"Disabled",voiceURI:""}),this.voiceList.value.length>0)){this.selectedVoice.value=this.voiceList.value[0].name;const e=window.localStorage.getItem("selectedVoice");if(e!==null){const s=this.voiceList.value.find(t=>t.name===e);s!==void 0&&(this.selectedVoice.value=s.name)}}}getSelectedVoice(){return this.voiceList.value.find(e=>e.name===this.selectedVoice.value)}async speak(e){return new Promise((s,t)=>{if(this.provider===null)return t("SpeechSynthesis not supported");if((this.getSelectedVoice()??this.voiceList.value[0]).name==="Disabled")return t("Voice is disabled");const h=new SpeechSynthesisUtterance(e);h.voice=this.getSelectedVoice()??this.voiceList.value[0],h.pitch=this.pitch,h.rate=this.rate,h.onend=s,h.onerror=t,this.provider.speak(h)})}async speakQueue(){this.queue.length===0&&(console.log("hij is klaar"),this.trigger("done",null));const e=this.queue.shift();if(e!==void 0){try{this.isSpeakingQueue.value=!0,await this.speak(e),this.isSpeakingQueue.value=!1}catch(s){this.isSpeakingQueue.value=!1,console.error(s)}this.speakQueue()}}async queueSpeak(e){e.trim()!==""&&(this.queue.push(e),!this.isSpeakingQueue.value&&(this.trigger("start",null),await this.speakQueue()))}async queueSpeakPartials(e){this.partialBuffer+=e;let s=[".","!","?",",","..."];for(let t=0;t<s.length;t++){const r=s[t];if(this.partialBuffer.includes(r)){const h=this.partialBuffer.split(r),c=h[0]+r;this.partialBuffer=h.slice(1).join(r),this.queueSpeak(c);break}}this.partialTimeout!==null&&window.clearTimeout(this.partialTimeout),this.partialTimeout=window.setTimeout(()=>{this.queueSpeak(this.partialBuffer),this.partialBuffer=""},1e3)}cancel(){this.provider!==null&&this.provider.cancel()}pause(){this.provider!==null&&this.provider.pause()}resume(){this.provider!==null&&this.provider.resume()}}const tt={class:"h-screen bg-[#2e333d]"},st={key:0,class:"fixed flex-grow-0 z-20 top-0 left-0 right-0 flex gap-2 text-white p-4 md:p-6 overflow-auto"},it=n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})],-1),nt=[it],ot={class:"whitespace-nowrap backdrop-brightness-50 backdrop-blur-xl text-white rounded-lg px-3 py-2"},rt={key:1,class:"fixed z-50 top-0 left-0 right-0 bottom-0 overflow-scroll backdrop-brightness-90 backdrop-blur-3xl text-white/80 p-5"},at={class:"flex flex-col gap-2"},lt={class:"flex"},ut=n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1),ct=[ut],dt={class:"grid grid-cols-12 gap-4"},ht=["innerHTML"],pt={class:"flex col-span-6 flex-col gap-2"},gt=n("span",null,"Bot name:",-1),mt={class:"flex col-span-6 flex-col gap-2"},ft=n("span",null,"Description:",-1),vt={class:"flex col-span-6 flex-col gap-2"},bt=n("span",null,"Color:",-1),wt={class:"flex col-span-6 flex-col gap-2"},St=n("span",null,"Temperature:",-1),kt={class:"flex col-span-6 flex-col gap-2"},yt=n("span",null,"Max tokens:",-1),xt={class:"flex col-span-12 flex-col gap-2"},_t=n("span",null,"Welcome message:",-1),Ct={class:"flex col-span-12 flex-col gap-2"},Lt=n("span",null,"Random subject:",-1),Et={class:"flex col-span-12 flex-col gap-2"},Mt=n("span",null,"System prompt:",-1),Tt={class:"flex col-span-12 flex-col gap-2"},Rt=n("span",null,"Summarize prompt:",-1),Vt={class:"flex col-span-12 flex-col gap-2"},Nt=n("span",null,"Speaking Voices: ",-1),Ot=["value"],Pt={class:"col-span-6"},Dt={class:"col-span-6"},It={class:"col-span-6"},At={class:"col-span-6"},Bt={class:"flex flex-col h-full"},Wt={class:"relative flex grow-0 shrink-0 px-4 md:px-6 flex-col bg-white/5"},Ut=["placeholder","onKeydown"],$t=n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z"})],-1),Ft=[$t],Ht=de({__name:"ChatView",setup(a){const i=p(""),e=p(),s=p(),t=me(),r=he(),h=Z(),c=new Ze("nl-NL"),v=new ce,S=new et("nl"),b=new ce,C=p(""),g=p(""),f=p(""),y=p(""),W=p(""),I=p(""),U=p(1),$=p(250),F=p(""),z=p(""),G=p("");let l=null;Pe(async()=>{let w=j.currentRoute.value.params.slug;if(w&&(w=Array.isArray(w)?w[0]:w,r.selectCharactersFromSlug(w)),l=r.selectedCharacter,l==null)return j.push({name:"characters"});g.value=l.botSlug,C.value=l.botName,f.value=l.systemPrompt,y.value=l.summarizePrompt,W.value=l.description,I.value=l.color,U.value=l.temperature,$.value=l.maxTokens,F.value=l.welcomeMessage,z.value=l.randomSubject,G.value=l.avatar,k(g,(o,d)=>{o!=d&&(l.botSlug=o,r.saveSelectedCharacter(),j.push({name:"chatWithCharacter",params:{slug:l.botSlug}}))}),k(C,(o,d)=>{l.botName=o,r.saveSelectedCharacter()}),k(f,o=>{l.systemPrompt=o,r.saveSelectedCharacter()}),k(I,o=>{l.color=o,r.saveSelectedCharacter()}),k(y,o=>{l.summarizePrompt=o,r.saveSelectedCharacter()}),k(W,o=>{l.description=o,r.saveSelectedCharacter()}),k(U,o=>{l.temperature=o,r.saveSelectedCharacter()}),k($,o=>{l.maxTokens=o,r.saveSelectedCharacter()}),k(F,o=>{l.welcomeMessage=o,r.saveSelectedCharacter()}),k(z,o=>{l.randomSubject=o,r.saveSelectedCharacter()}),k(G,o=>{l.avatar=o,r.saveSelectedCharacter()}),c.on("transcript",async o=>{i.value=o,await ie()}),t.loadMessagesFromLocalStorage(l.botSlug),setTimeout(()=>{N(),l!=null&&l.welcomeMessage&&_e(l==null?void 0:l.welcomeMessage.replace("[name]",h.myName),1,.5,1e3)},10)});async function ke(){c.toggleListen()}function N(){e.value&&(e.value.scrollTop=e.value.scrollHeight)}function ye(){G.value=Be(),console.log("x")}function xe(){N(),l.botName;let w=t.addMessage(new V("","SUMMARY","assistant")),o=l.systemPrompt,d=t.chatLogSinceCheckpoint;console.log(d),b.complete({messages:[new V(o,l.botName,"system").toGptMessage(),new V("Conversatie log: "+d,l.botName,"assistant").toGptMessage(),new V(l.summarizePrompt,l.botName,"assistant").toGptMessage()],model:h.model,stream:!0}),b.on("progress",({result:x,partial:O})=>{w.setContentWeirdBug(x),N()}),b.once("done",x=>{w.setContentWeirdBug(x),b.off("progress"),N(),oe(()=>{N(),t.saveMessages(l.botSlug)})})}function _e(w="",o=.5,d=.5,x=1e4){var ne;let O=l.botName,A=h.myName,T=Math.random()>1-o,Q=Math.random()>1-d;if(T){if(console.log("Preparing surpise message"),Q){let Y=De(["Telescope","Pineapple","Fusion","Blueprint","Courage","Sapphire","Notebook","Curiosity","Dream","Echelon","Rainbow","Library","Lighthouse","Harmonica","Quantum","Elephant","Windmill","Camouflage","Zephyr","Kaleidoscope","Discover","Flamingo","Lavender","Symphony","Nebula","Rhythm","Echo","Iridescent","Pirate","Voyage","Whisper","Silver","Rejuvenate","Sanctuary","Solitude","Lemonade","Illusion","Momentum","Flicker","Sunset","Gravity","Chimera","Butterfly","Silhouette","Frost","Radiance","Enigma","Journey","Astronaut","Galaxy"]);w+=(ne=l==null?void 0:l.randomSubject)==null?void 0:ne.replace("[subject]",Y),console.log(w)}setTimeout(()=>{let P=t.messagesSinceCheckpoint.filter(Y=>!Y.isCheckpoint()).slice(-2);i.value.trim().length===0&&(P.length==2&&P[0].name===A&&P[1].name===O||P.length==1&&P[0].name===A||P.length==0)&&se(w)},x)}}function se(w=""){let o=l.botName,d=h.myName,x=new V(l.systemPrompt+". Dit gesprek is met "+d,o,"system").toGptMessage(),O=w?new V(w,o,"system").toGptMessage():null,A=t.addMessage(new V("",o,"assistant"));console.log(l.systemPrompt),v.complete({messages:[x,...t.messagesSinceCheckpoint.map(T=>T.toGptMessage()),O].filter(T=>T),temperature:l==null?void 0:l.temperature,max_tokens:l==null?void 0:l.maxTokens,model:h.model,stream:!0}),v.on("progress",({result:T,partial:Q})=>{A.content.value=T,N(),S.queueSpeakPartials(Q)}),c.stopListen(),S.once("done",()=>{c.startListen()}),v.once("done",T=>{console.log(t.chatLogSinceCheckpoint),A.content.value=T,v.off("progress"),t.saveMessages(l.botSlug)})}async function ie(){t.addMessage(new V(i.value,h.myName,"user")),i.value="",se(),oe(()=>{N()})}async function Ce(w){w.shiftKey||(await ie(),w.preventDefault())}return(w,o)=>(L(),M("div",tt,[u(t).overlayIsShown?D("",!0):(L(),M("div",st,[n("button",{onClick:o[0]||(o[0]=d=>u(j).push({name:"characters"})),class:"whitespace-nowrap backdrop-brightness-50 backdrop-blur-xl text-white rounded-lg px-3 py-2"},nt),n("button",{onClick:o[1]||(o[1]=d=>u(t).toggleOverlay()),class:"whitespace-nowrap backdrop-brightness-50 backdrop-blur-xl text-white rounded-lg px-3 py-2"},"Settings"),n("button",{onClick:xe,class:"whitespace-nowrap backdrop-brightness-50 backdrop-blur-xl text-white rounded-lg px-3 py-2"},"Summarize"),n("button",{onClick:o[2]||(o[2]=d=>{var x;return u(t).clearMessages((x=u(l))==null?void 0:x.botSlug)}),class:"whitespace-nowrap backdrop-brightness-50 backdrop-blur-xl text-white rounded-lg px-3 py-2"},"Clear messages"),n("button",{onClick:o[3]||(o[3]=d=>u(r).deleteCharacter(u(l))),class:"whitespace-nowrap backdrop-brightness-50 backdrop-blur-xl text-white rounded-lg px-3 py-2"},"Delete"),n("button",ot," Est tokens: "+R(u(t).estimatedTokenCount),1)])),u(t).overlayIsShown?(L(),M("div",rt,[n("div",at,[n("div",lt,[n("button",{onClick:o[4]||(o[4]=d=>u(t).toggleOverlay()),class:"bg-black/50 backdrop-blur-xl ml-auto text-white rounded-full w-10 p-2"},ct)]),n("div",dt,[n("div",{class:"flex col-span-12 flex-col gap-2 items-center mb-4 pt-10 -m-10 -mt-20",style:ge({backgroundColor:I.value})},[n("button",{onClick:o[5]||(o[5]=d=>ye()),class:"w-48 h-48 rounded-3xl",innerHTML:u(pe)(G.value)},null,8,ht)],4),n("div",pt,[gt,_(n("input",{"onUpdate:modelValue":o[6]||(o[6]=d=>C.value=d),class:"border-transparent rounded-lg p-3 bg-black/40"},null,512),[[E,C.value]])]),n("div",mt,[ft,_(n("input",{"onUpdate:modelValue":o[7]||(o[7]=d=>W.value=d),class:"border-transparent rounded-lg p-3 bg-black/40"},null,512),[[E,W.value]])]),n("div",vt,[bt,_(n("input",{"onUpdate:modelValue":o[8]||(o[8]=d=>I.value=d),class:"border-transparent rounded-lg p-3 bg-black/40"},null,512),[[E,I.value]])]),n("div",wt,[St,_(n("input",{type:"number",step:"0.1",min:"0",max:"1","onUpdate:modelValue":o[9]||(o[9]=d=>U.value=d),class:"border-transparent rounded-lg p-3 bg-black/40"},null,512),[[E,U.value]])]),n("div",kt,[yt,_(n("input",{type:"number",step:"1",min:"0",max:"5000","onUpdate:modelValue":o[10]||(o[10]=d=>$.value=d),class:"border-transparent rounded-lg p-3 bg-black/40"},null,512),[[E,$.value]])]),n("div",xt,[_t,_(n("input",{"onUpdate:modelValue":o[11]||(o[11]=d=>F.value=d),class:"border-transparent rounded-lg p-3 bg-black/40"},null,512),[[E,F.value]])]),n("div",Ct,[Lt,_(n("input",{"onUpdate:modelValue":o[12]||(o[12]=d=>z.value=d),class:"border-transparent rounded-lg p-3 bg-black/40"},null,512),[[E,z.value]])]),n("div",Et,[Mt,_(n("textarea",{rows:"5","onUpdate:modelValue":o[13]||(o[13]=d=>f.value=d),class:"border-transparent rounded-lg p-3 bg-black/40"},null,512),[[E,f.value]])]),n("div",Tt,[Rt,_(n("textarea",{rows:"5","onUpdate:modelValue":o[14]||(o[14]=d=>y.value=d),class:"border-transparent rounded-lg p-3 bg-black/40"},null,512),[[E,y.value]])]),n("div",Vt,[Nt,_(n("select",{"onUpdate:modelValue":o[15]||(o[15]=d=>u(S).selectedVoice.value=d),class:"text-white/90 border-transparent rounded-lg p-2 bg-black/40"},[(L(!0),M(J,null,re(u(S).voiceList.value,d=>(L(),M("option",{value:d.name},R(d.name)+" - "+R(d.lang),9,Ot))),256))],512),[[Ie,u(S).selectedVoice.value]])]),n("div",Pt,"Speech Recognition Status: "+R(u(c).status),1),n("div",Dt,"Listening: "+R(u(c).isListening),1),n("div",It,"Speaking: "+R(u(S).status),1),n("div",At,"Speaking Queue: "+R(u(S).queue.length)+" / "+R(u(S).isSpeakingQueue),1)])])])):D("",!0),n("div",Bt,[n("div",{ref_key:"scroller",ref:e,class:"flex grow overflow-y-auto pt-32"},[n("div",{ref_key:"scrolled",ref:s,class:"flex w-full h-auto gap-2 flex-col m-4 md:m-6 !mt-auto"},[(L(!0),M(J,null,re(u(t).messages,(d,x)=>{var O;return L(),We(Xe,{"show-user":((O=u(t).messagesSinceCheckpoint[x+1])==null?void 0:O.name)!==d.name||typeof u(t).messagesSinceCheckpoint[x+1]>"u",key:d.id,message:d},null,8,["show-user","message"])}),128))],512)],512),n("div",Wt,[_(n("textarea",{placeholder:u(c).interimTranscript.value?u(c).interimTranscript.value:"Your message",onKeydown:Ae(Ce,["enter"]),rows:"4",class:"py-4 text-lg resize-none focus:outline-none bg-transparent rounded-lg text-white","onUpdate:modelValue":o[16]||(o[16]=d=>i.value=d)},null,40,Ut),[[E,i.value]]),n("button",{class:H(["mr-4 md:mr-6 backdrop-blur-xl transition-all cursor-pointer hover:scale-105 absolute flex items-center justify-center right-0 top-4 w-10 h-10 rounded-full",{"backdrop-brightness-0 text-white !scale-100":u(c).isListening.value,"backdrop-brightness-90 text-white/40":!u(c).isListening.value}]),onClick:o[17]||(o[17]=d=>ke())},Ft,2)])])]))}});export{Ht as default};
